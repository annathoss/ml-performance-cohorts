---
title: "Performance of prediction models for opportunities for improvment in trauma care across patient cohorts"
author: "Anna Thoss"
output:
  pdf_document: default
  html_document: default
  word_document: default
bibliography: bibliography.bib
csl: vancouver.csl
---


```{r setup, include=FALSE, echo=FALSE}
library(knitr)
library(kableExtra)
library(flextable)

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, comment = NA)

set_flextable_defaults(
  font.size = 8,
  theme_fun = theme_vanilla,
  padding.top = 1,
  padding.bottom = 1,
  padding.left = 1,
  padding.right = 1
)

output.format <- knitr::opts_knit$get('rmarkdown.pandoc.to')

source("./main.R")
```

```{=html}
<!-- This is an R Markdown document. Markdown is a simple formatting
syntax for authoring HTML, PDF, and MS Word documents. For more
details on using R Markdown see http://rmarkdown.rstudio.com -->
```
```{=html}
<!-- This is a comment and will not be present in the compiled
document. Try "knitting" this document by clicking the knit button up
to the left, or by running `rmarkdown::render("manuscript.Rmd")` in
the console and you should only see headings -->
```
```{=html}
<!-- Structure and most comments are from the Strengthening the
reporting of observational studies in epidemiology (STROBE) statement,
see https://www.strobe-statement.org/. For more explanations see the
paper Strengthening the Reporting of Observational Studies in
Epidemiology (STROBE):explanation and elaboration.  -->
```
```{=html}
<!-- Indicate the study’s design with a commonly used term in the
title, for example: "Associations between resuscitation interventions
and opportunities for improvement in adult trauma patients: A cohort
study" -->
```
# Abstract

```{=html}
<!-- Provide in the abstract an informative and balanced summary of
what was done and what was found. Not more than 300 words. -->
```
## Background
Trauma is among the leading causes of mortality and morbidity worldwide. The selective review of patient's mortality and morbidity cases is used to improve quality of care through identification of opportunities for improvement (OFI). The aim of this study was to compare how machine learning models perform the prediction of OFI across different trauma cohorts. 

## Methods
We conducted a registry based study using all trauma patients at the Karolinska University Hospital from 2017 till 2021 that had undergone review for possible OFI. Previously trained machine learning models were assessed using statistical analysis to determine their prediction value across different patient cohorts. 

## Results

## Conclusion



# Introduction
Trauma, defined as the clinical entity composed of the combination of physical injury and the body's associated responses [@gerdin_risk_2015] is a significant public health concern worldwide. It accounts for a substantial portion of morbidity and mortality rates, being the cause of 4.3 million fatalities each year [@injuries2020]. It is the leading cause of death for people aged 18-39 [@Peng2023-gd]. Trauma, and care of patients with traumatic injuries, have long been a significant target point for healthcare improvement programs [@WHO2009]. Multidisciplinary morbidity and mortality conferences form a cornerstone of initiatives dedicated to enhancing the quality of trauma care and consequently, improving patient outcomes [@Santana2014].

### Opportunities for improvement
Audit filters, a system used to flag abnormal clinical parameters as possible opportunities for improvement (OFI), are applied to determine possible events in patient care that are associated with unfavourable outcomes. The occurrence of such an event triggers a review process, which in turn leads to a meeting of the multidisciplinary review board during mortality and morbidity conferences. An OFI is a consensus decision made during a conference and includes proposals for corrective actions, and when appropriate implementation of corrective measures to address systematic errors and feedback to individual practitioners [@McDermott_1994]. At mortality and morbidity conferences, representatives from different professions and specialities adjacent to trauma care come together to discuss care provided to a specific patient and compare it to care given under optimal conditions. The findings of such a conference are whether OFI can be found in any given case. Examples of OFI may include lack of resources and management errors [@Lazzara2020]. The use of audit filters has its drawbacks, being associated with high rates of false positives [@Sanddal2011; @Ghorbani2018; @Evans2009].

### Artificial intelligence
In recent years, artificial intelligence (AI) has made great advances, making it an exciting opportunity for the development of  more sophisticated prediction models. This opens up a wide field of possible future healthcare applications. Research on AI implementation for clinical use has become commonplace and has already been tried in some clinical contexts, such as aiding in the diagnosis of pathologies through analysis of radiological images [@Cellina2022-qp] as well as epidemiological prediction of disease patterns, an example being during the COVID-19 pandemic [@Chen2020-ue].

With AI, computing is used to mimic human intelligence, characterized by its ability to learn and reason. Through predictive modelling, AI can be used as a tool to problem solve. Computation has the advantage of analysing great quantities of data in a short time, giving it an edge [@Cellina2022-qp]. The primary way to achieve AI is through machine learning (ML), in which statistical modelling is applied to a computer system where it learns from previous data, and thus circumvents human programming. The approach with ML has increasingly been utilized to analyse data and can be used to gain further information from data, such as making predictions of outcomes[@MLJung]. The ability to improve modelling algorithms with the use of ML thus has the ability to improve said algorithms autonomously, which in turn opens the door for a wide array of applications in healthcare. One such application is to develop more accurate prediction models that can further quality improvement programs.

### AI in trauma care
Following the general trend towards implementation of machine learning models within healthcare, there has been research into possible application within the wider field of trauma care. Previous methods to predict outcomes within trauma, such as Injury severity score (ISS) and Trauma and Injury severity score (TRISS) were developed using much smaller quantities of data than processing allows for these days[@Zhang2022], this has lead some to call their accuracy of prediction into question.[@Schetinin2018]. There is an implicit heterogeneity to trauma patients, which lends itself well to machine learning modelling, having not only the ability to make predictions based on a greater dataset, but also circumvents problems as it can handle unstructured and nonlinear data and account for missing values.[@Zhang2022]

Previous studies have found that delay of treatment along with errors in judgement are the leading causes of mortality in level 1 trauma centres.[@Teixeira2007;@Teixeira2009] Machine learning has been found to outperform clinical tools for prediction of mortality.[@Kareemi2021] Research on morbidity in trauma patients has been less conclusive, and fewer studies have been done on the topic, with most focusing on mortality.[@Zhang2022] 

To enhance the precision of the selection process for mortality and morbidity conferences, there have been efforts to introduce trauma mortality prediction models. Nevertheless, the performance of these models has been unsatisfactory, being poor predictors for OFI [@Ghorbani2018; @Heim_2016]. This is likely because these models were originally developed with a focus on predicting mortality rather than morbidity or instances of care failures within the realm of trauma care. Machine learning-based prediction models have been found to outperform conventional methods to predict opportunities for improvement [@Attergrim2023].

### Trauma care in different patient cohorts
The array of injuries to the body that fall under trauma is wide. Following this, there is also a wide array of bodily responses to said injury. For instance, traumatic brain injury (TBI) will impact the body in different ways than an injury without TBI, since the body's response mechanism might be impaired by the neural injury in itself. This was shown BLAA BLAA BLAA. [Behöver KÄLLA] Along the same line, the mechanism of injury, such as blunt force trauma compared to severe penetrating trauma may also trigger different mechanisms and present with a different set of parameters clinical[BEHÖvER KÄLLA]. Thus, it is important, that given the differences in cohorts falling under the wider term trauma patient, that the model used for predicting OFI does not discriminate or vary widely between the cohorts, so as not to leave out a subgroup of patients from optimising the care of said patients. 

- predicting outcomes is difficult, complexity. young group. 

# Aim

To assess the difference in performance of prediction models for opportunities for improvement in trauma care across different clinical trauma cohorts.

# Methods

#### Study setting and participants

We conducted a registry-based study, encompassing all trauma patients enlisted in both the Karolinska University Hospital trauma registry and the trauma care quality database spanning from 2012 to 2022. The Karolinska University Hospital in Solna is equivalent to a level 1 trauma centre and manages approximately 1,500 acute trauma patients each year [@Ghorbani2018; @swetrau]. The trauma registry comprises all patients admitted to the hospital with trauma team activation, irrespective of their Injury Severity Score (ISS), as well as patients with an ISS exceeding 9. Included in the registry is data on vital signs, injuries, interventions, times, and patient demographics.

The trauma registry encompasses approximately 12,000 patients treated from 2012 to 2022. The trauma care quality database in turn is a subset of the trauma registry, including about 6000 patients selected for review in the years 2013-2022.

<!-- Consider citing Hussein's paper in your definition of OFI: "The outcome was the presence of OFI, as decided by the morbidity and mortality conference. An OFI is any failure of care including, but not limited to, any potentially preventable or preventable death, delay in treatment, clinical judgment error, missed diagnosis and technical error as decided by the mortality and morbidity conference. The study outcome is binary with the levels “Yes - At least one OFI identified” and “No - No OFI identified”."

https://sjtrem.biomedcentral.com/articles/10.1186/s13049-023-01157-y

-->

OFI are identified through meetings of the multidisciplinary review board during mortality and morbidity conferences. An OFI is a consensus decision made during a conference and includes proposals for corrective actions. These in turn are recorded in the trauma care quality database. The trauma care quality database also includes data relevant to mortality and morbidity conferences, such as audit filters. The mortality and morbidity conferences at Karolinska University Hospital involve professionals from various specialities within trauma care, including surgery, neurosurgery, orthopaedics, anaesthesia, intensive care, nursing, and radiology. Cases considered for a conference go through multiple rounds of review. Mortality leads to direct inclusion.

Between 2013 and 2017, non-fatal poor outcomes were identified through reviews conducted by a specialized trauma nurse to identify potential OFI. Starting in 2017, the process was formalized, involving an initial review by a specialized trauma nurse along with the application of audit filters. All cases that were flagged either during the initial nurse review or by the audit filters underwent a secondary review conducted by two specialized nurses. If the second review identified potential areas for improvement (OFI), the case was marked for discussion in a multidisciplinary conference.

![](assets/OFI-flow.png) Figure illustrating process of mortality and morbidity conference at Karolinska University Hospital.

#### Eligibility criteria

All patients reviewed for possible OFI between the years 2013 and 2022 are included in the study, with the exception of patients under the age of 15 due to differing clinical pathways in this subgroup.

#### Outcome

The outcome of this study will be defined as "Yes, there is a significant difference in models prediction of OFI in different cohorts" or "No, there is no significant difference in models prediction of OFI in different cohorts." Data for this will be extracted from the trauma care quality database and run through a number of machine learning models, that have been trained previous to this study.

#### Predictors

All variables from the trauma registry are considered potential predictors in our analysis and have been incorporated into the models. <!-- Note that the models are already developed. So you should write about what have already been done,i.e. these variables are already incorporated into the
models-->These variables include information spanning the pre-hospital, initial care, and subsequent in-hospital phases, which include initial vital signs, timing, and types of procedures and interventions, duration and level of care, injury details, mechanisms of injury, injury types, and standard demographic information. This array of predictors comprises both continuous and categorical variables, ultimately resulting in the final models utilizing a total of 45 predictors.

All available data was used, with a sample size of 6310 patients. This is due to previously developed prediction models being based on all available data, as well as including all 45 predictors regardless of the learner used for the development of the model.

The models have been developed and trained on the data set previous to this study [@Attergrim2023]. Eight models are included, all being developed using the Tidymodels framework [@tidymodels]. These include logistic regression (LR), random forest (RF), decision tree (DT), support vector machine with a radial basis kernel (SVM), XGBoost, LightGBM, CatBoost, and k-nearest neighbor (k-NN).

#### Cohorts

The different models' performance were assessed in the following cohorts:

1.  Isolated severe TBI: Injury isolated to the area of the brain with AIS \> 2 and:

    a.  pre-hospital GCS of \< 9

        or

    b.  Pre- or in-hospital intubation.

2.  Blunt multi-system trauma without TBI: Blunt trauma with AIS \> 2 and injuries in at least two of the following AIS body regions: head, face, neck, thorax, abdomen, spine, or upper and lower extremities and no injury to the brain with AIS \>2 and:

    a.  pre-hospital GCS of \< 9

        or

    b.  Pre- or in-hospital intubation.

3.  Blunt multi-system trauma with TBI: Blunt trauma with AIS \> 2 and injuries in at least two of the following AIS body regions: head, face, neck, thorax, abdomen, spine, or upper and lower extremities and with injury to the brain with AIS \>2 and:

    a.  pre-hospital GCS of \< 9

        or

    b.  Pre- or in-hospital intubation
    
4.  Severe penetrating: At least one AIS \>2 injury in any of the following AIS body regions: neck, thorax, abdomen. 

5.  Other cohort: Patient does not fall into any of the above. 


Along with these cohorts, all machine learning models were assessed regarding differences between male and female sex in their prediction of OFI.

#### Statistical analysis

R was employed for all statistical analysis. For the analysis, a 95% confidence level and 5% significance level were employed. For each model, the performance was assessed in the predefined cohorts and compared to other models performance in regards to sensitivity and specificity.

## Ethical considerations

The nature of this study is non-invasive. However, handling of registry data constituts a risk for breach of patients integrity. The registry used in this study does contain personal identification. In order to minimize the risk of breach, patients have been semi-anonymized after collection of data and been assigned a new identification number upon entry into dataset. Due to the nature of the patient population, patients have not consented previous to entry into the registry, thus, there is an opt out principle applied here. This is common with registry data in Sweden, and opens up opportunities for studies in a wide range of fields. In turn, more scientific knowledge has great potential for benefit, both on the societal scale, as well as the individual. Thus, the risk for the individual is comparably small. Further, no individual patients data is presenteed in the study, mitigating risk of violating personal integrity. The study has been granted ethical permit, with the record number 2021-02541 and 2021-03531.

## Study design

<!-- Present key elements of study design -->

## Setting

```{=html}
<!-- Describe the setting, locations, and relevant dates, including
periods of recruitment, exposure, follow-up, and data collection -->
```
## Participants

```{=html}
<!-- Cohort study: Give the eligibility criteria, and the sources and
methods of selection of participants. Describe methods of
follow-up. For matched studies, give matching criteria and number of
exposed and unexposed -->
```
```{=html}
<!-- Case-control study: Give the eligibility criteria, and the
sources and + methods of case ascertainment and control
selection. Give the rationale for the choice of cases and
controls. For matched studies, give matching criteria and the number
of controls per case -->
```
```{=html}
<!-- Cross-sectional study: Give the eligibility criteria, and the
sources and methods of selection of participants -->
```
## Variables and data sources/measurements

```{=html}
<!-- Clearly define all outcomes, exposures, predictors, potential
confounders, and effect modifiers. Give diagnostic criteria, if
applicable. For each variable of interest, give sources of data and
details of methods of assessment (measurement). Describe comparability
of assessment methods if there is more than one group -->
```
## Bias

<!-- Describe any efforts to address potential sources of bias -->

## Study size

<!-- Explain how the study size was arrived at -->

## Quantitative variables

```{=html}
<!-- Explain how quantitative variables were handled in the
analyses. If applicable, describe which groupings were chosen and why
-->
```
## Statistical methods

```{=html}
<!-- 

(a) Describe all statistical methods, including those used to control
for confounding

(b) Describe any methods used to examine subgroups and interactions

(c) Explain how missing data were addressed 

(d) 

Cohort study: If applicable, explain how loss to follow-up was addressed 

Case-control study:If applicable, explain how matching of cases and
controls was addressed

Cross-sectional study: If applicable, describe analytical methods
taking account of sampling strategy

(e) Describe any sensitivity analyses
-->
```
# Results

### Participants


```{r tab1, echo=FALSE, fig.cap="Selected sample characteristics", fig.align='center' }
if (output.format == "latex") {
  tab1 <- t1kable(create.tableone(dataset), "latex", longtable = T, booktabs = T) %>%
    kable_styling(latex_options = c("repeat_header", "condensed"), repeat_header_text = "(cont.)", font_size = 8) %>%
    kableExtra::footnote(general = "\\\\textit{Definition of  abbreviations:} OFI = Opportunity for Improvement; ED = Emergency Department; GCS = Glascow Coma Scale.\\\\newline Time to first CT and Time to definitive treatment: Measured in minutes from arrival at the hospital.", general_title = "",threeparttable =  TRUE, escape = FALSE)
} else if (output.format == "docx") {
    tab1 <- t1flex(create.tableone(dataset)) %>%
      add_footer_lines("OFI = Opportunity for Improvement; ED = Emergency Department; GCS = Glascow Coma Scale.") %>%
      autofit()
}

tab1
```

Karolinska trauma registry contains 11864 patients<!--Dubbelkolla antal!-->, of which 8309 are reviewed for OFI, either through selection by individual review or application of audit filters, as well as an unknown process <!--(n=2)-->. 


Through this, 1316 patients were selected for the morbidity conference, and 596 patients for the mortality conference. Out of 596 deaths reviewed, 35 were found to be preventable (n=4) or possibly preventable (n=31). The remaining 561 patients were thus rendered non-preventable without OFI. Further, 1316 alive patients were included during a morbidity conference, of which 396 (7%) were identified as cases with OFI.


Among the 6310 patients, the majority (n=4383) (69%) were male, and the mean age was 45 (SD 21). Overall, the mortality in the group was 599 (9%).

In the group identified as OFI (n = 431), the mean age was somewhat higher than in the group without OFI (n=5879) (mean 48 vs 45 years). For OFI patients, they were most commonly treated at an intensive care unit (35%), whereas patients without OFI were most commonly treated at a general ward (37%). ISS was also higher for OFI patients (mean: 19, SD:11 vs mean: 12, SD:13). In-hospital intubation occurred in 74 (17%) OFI patients, compared to non-OFI (n=460, 8%). They had a longer time till definitive treatment (median: 143 vs 99 minutes from hospital arrival). Definitive treatments differed, with OFI patients receiving more interventions, particularly radiological (7% vs 1%).

The variables most frequently missing data were "Time to normal BE" (n=6107), "Pre-hospital intubation type" (N=5812), and "Emergency department intubation type" (n=5749).


### Descriptive data

### Outcome data

### Main result

```{r main.result, echo=FALSE}
kable(cohort.performance.results, caption = "LÄGG TILL CAPTION HÄR")
```

<!-- KS: P-value was < 10-6 between the cohorts. Present that value where it suits you -->

```{r roc.curves, out.width="80%",fig.cap="ROC Curves. LÄGG CAPTION HÄR", echo=FALSE, fig.align='center'}
knitr::include_graphics("figures/roc.pdf", error = FALSE)
```

### Other analysis

```{=html}
<!-- 

Participants
------------

(a) Report numbers of individuals at each stage of study—eg numbers
potentially eligible, examined for eligibility, confirmed eligible,
included in the study, completing follow-up, and analysed

(b) Give reasons for non-participation at each stage

(c) Consider use of a flow diagram

Descriptive data
----------------

(a) Give characteristics of study participants (eg demographic,
clinical, social) and information on exposures and potential
confounders

(b) Indicate number of participants with missing data for each
variable of interest

(c) Cohort study — Summarise follow-up time (eg, average and total
amount)

Outcome data
------------

Cohort study — Report numbers of outcome events or summary measures
over time

Case-control study — Report numbers in each exposure category, or
summary measures of exposure

Cross-sectional study — Report numbers of outcome events or summary
measures

Main results
------------

(a) Give unadjusted estimates and, if applicable, confounder-adjusted
estimates and their precision (eg, 95% confidence interval). Make
clear which confounders were adjusted for and why they were included

(b) Report category boundaries when continuous variables were
categorized

(c) If relevant, consider translating estimates of relative risk into
absolute risk for a meaningful time period

Other analyses 
--------------

Report other analyses done—eg analyses of subgroups and interactions,
and sensitivity analyses 
-->
```
You can include code in this document like this:

```{r main, echo=FALSE}
source("main.R") ## This "imports" the main script file of your project and run any code in it
```

You can also embed plots:

```{r plot, echo=FALSE}
plot(pressure)
```

You can also mix text and code, so called inline code, like this: `r 2+5`.

# Discussion
### Key results
- Summering av resultat + koppla till aim

- Limitations: 

The potential of machine learning to aid clinicians in their efforts to improve trauma care quality and test the viability of its implementation in regards to application in different cohorts of trauma patients was at the forefront of this investigation. The result show that our models perform well in identifying OFI across the investigated cohorts. 

As this is a novel field, and research on similar applications of machine learning models to identify both mortality as well as morbidity is slim, especially in regard to OFI, it is hard to make a though discussion on how it compares to other findings in the field. However, a review from 2022 identified 

 <!-- Diskussionen kan läsas fristående och inleds därför
med en kort sammanfattning av syfte eller
problemställning, och viktigaste fynd 

Egna resultat analyseras och diskuteras i
förhållande till studiens syfte


Egna resultat analyseras och diskuteras i
förhållande till stödjande resp motsägande aktuell
forskning --> 

### Limitations

<!-- Studiens (tekniska) styrkor och svagheter
diskuteras (t ex val av metod/design och
tillförlitlighet av metod och data) i eget stycke med
särskild underrubrik --> 

The study had several limitations. Firstly, the nature of OFI is defined as a binary- variable. However, events leading up to a case being positive for OFI contains a multitude of variables, and can be determined by outcomes ranging from bad documentation to preventable death. Behind these are a diverse set of possible clinical events, which in turn can be determined by different predictors. 

Secondly, our learners are dependent on the current selection process for OFI, as this makes out the training data and thus makes out the groundwork for what is considered OFI in our dataset. As a consequence, the models are prone to the same limitations as the current system of audit filters. The review process is dependent both the individual review of specialized nurses, along with the current set of audit filters, which may not be the optimal parameters for demeriting OFI. This introduces an inherent bias. The audit filter system favour some types of error, while possibly missing others. At Karolinska University Hospital, the current system is more apt at identifying severe clinical outcomes, such as preventable death, or patient cases with more interventions or longer hospital stays, and flagging them as possible OFI. Higher ISS scores and "Days in hospital" have been found to be predictors of high importance when identifying OFI [Hussein]. This in turn introduces possible selection bias, giving a sewed view of errors within the trauma care, and as such not a holistic view of the trauma care quality. 

Further, machine learning models are suboptimal when applied to cases with rare events, as they are limited to what they have previously been trained on. This means that not only are they limited when finding OFI in cases with novel predictors or events that lead with error, but the models are also prone to creating a self-reinforcing cycle, making them specialised on finding a set of OFI with accuracy. The current system can circumvent such by the individual review followed by a mortality and morbidity conference. If the model approach to predicting OFI is to be implemented in clinical practice, some other form, either individual review or other form of identification would be needed to supplement the machine learning model to assure prediction previously unknown basis for OFI. 

Finally, given that the aim of identifying OFI at mortality and morbidity conferences is the correction of errors within the system of trauma care, with time and implementation of corrective actions, the the scenarios and following this the parameters that predict OFI may change. 

### Interpretation

### Generalisability

<!-- Studiens praktiska implikationer eller betydelse
avseende medicinvetenskapliga/samhälleliga
koncept eller modeller diskuteras i eget stycke
med särskild underrubrik. Beskriv också och
problematisera aspekter av likabehandling inom
det valda forskningsområdet. Om likabehandling
inte anses vara relevant för studien ska detta
motiveras --> 

"Machine learning has the potential for heavy
bias, and the scrutiny of data sets, feature selection, and
external validation are imperative for further
implementation." - nr 18 review 

### Further research 
<!-- Under rubriken Fortsatta studier ges konkreta
förslag på nya hypoteser/frågeställningar och
studiedesign som kan ge svar på dessa -->

- Single center study > results illustrate situation in Stockholm. 
- Difference in performance men vs women. 

```{=html}
<!--

Key results
-----------
Summarise key results with reference to study objectives

Limitations
-----------

Discuss limitations of the study, taking into account sources of
potential bias or imprecision.  Discuss both direction and magnitude
of any potential bias

Interpretation
--------------

Give a cautious overall interpretation of results considering
objectives, limitations, multiplicity of analyses, results from
similar studies, and other relevant evidence

Generalisability
----------------

Discuss the generalisability (external validity) of the study results

-->
```
# Conclusion

<!-- Give a short conclusion, corresponding to the aim -->

# References

<!-- Do not edit by hand, references will be inserted and formatted automatically once you knit this document -->
